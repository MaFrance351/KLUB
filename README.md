# KLUB
Подключение прибора безопасности КЛУБ-У к ZDSimulator при помощи Arduino и софта ZDSimScanner

**Важно! Проект предоставляется "как есть", я не оказываю консультаций по его работе ввиду того, что сам лишь в процессе разбирательства с работой данного прибора. Нет, вообще никаких. Совсем. И вряд ли когда-нибудь буду, увы. Всё равно это единственный общедоступный софт для подключения БИЛ-В, БИЛ-У, БИЛ-УТ, БИЛ-УП к игре. Я проверял работу данного скетча, при правильной установке и подключении всё запускается с первого раза.
Пожалуйста, не надо писать мне где бы то ни было и требовать консультаций по данному софту. Нарушители этого правила будут забанены.**

Оборудование: Arduino Uno или Nano, модуль на чипе MCP2515, БП на 48 В, разъём СНЦ23-10/22Р

Устанавливаем библиотеку:
https://github.com/MaFrance351/arduino-mcp2515-25kbps

![](https://github.com/MaFrance351/KLUB/blob/master/MCP2515.PNG "")

![](https://github.com/MaFrance351/KLUB/blob/master/%D0%A0%D0%B0%D1%81%D0%BF%D0%B8%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0%20%D0%91%D0%98%D0%9B.png "")

Реализовано:
* Текущая скорость
* Допустимая скорость
* Давление в ТМ
* Давление в УР
* АЛСН
* Текущее время
* Лампа бдительности

Не реализовано:
* АЛС-ЕН, расстояние до цели, ускорение, станция, системные сообщения (неизвестно, как получить значения из игры)
* Координата, текущая дата, время по графику, профиль пути, коэф. торможения, запрет отпуска (неизвестно, как получить значения из игры, неизвестен формат пакета)

В скетче указать частоту кварца на модуле MCP2515 и скорость вашего БИЛа. На модуле установить перемычку (на фото справа внизу), подключающую оконечный резистор.

# Не работает?
Проверьте скорость вашего БИЛа. Они работают на скоростях 125 кбит/с или 25 кбит/с.
Проверьте кварц на модуле MCP2515. Частота должна совпадать с той, что указана в скетче. Модуль должен быть подрублен как на картинке.

Не заливается скетч, не загружается библиотека? Ознакомьтесь:
https://alexgyver.ru/arduino-first/

При запуске БИЛа он должен показать нулевой путь и отсутствие электронной карты. Если этого нет, нет реакции на кнопки, то либо неправильно подключили, либо не тот блок питания, либо БИЛ спален. Блок питания подойдёт от PoE-свитча, от электросамоката, гироскутера или тому подобной техники.
